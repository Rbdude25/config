name: Daily check to create PR for missing fields

on:
  schedule:
    - cron: '0 8 * * *'  # Runs at 8 AM UTC every day

permissions:
  contents: write
  pull-requests: write

jobs:
  update_fields:
    runs-on: ubuntu-latest
    container:
      image: ubuntu:latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Ensure all history is fetched
      
      - name: Install dependencies
        run: |
          apt-get update
          apt-get install -y jq curl

      - name: Run scripts to add missing fields
        run: |
          bash ./scripts/add_missing_endpoint_fields.sh
          bash ./scripts/add_missing_bootnode_fields.sh

      - name: Setup Git config
        run: |
          git config --global user.email "hq@rotko.net"
          git config --global user.name "Rotko Automation"

      - name: Commit changes
        run: |
          git fetch --all
          git checkout -b updates-${{ github.run_id }}
          git add members.json bootnodes.json
          git commit -am "Update dummy data based on daily checks"

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: |
            Autoupdates for endpoints and bootnodes
            This PR updates endpoints and bootnodes with dummy data based on comparing to member with most entries.
          title: "Autoupdates for endpoints and bootnodes"
          body: |
            This PR updates endpoints and bootnodes with dummy data based on comparing to member with most entries.
            See commits for details.
          labels: auto-update, bot
          assignees: hitchhooker
          reviewers: hitchhooker
          delete-branch: true
